<!DOCTYPE html>
<html>
	<head>
		<title>weather</title>
		<link rel="stylesheet" type="text/css" href="styles/main6.css">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyxCKbcngJdOCjgP1-UnRIhEBIc-tIVtM&signed_in=true&callback=initMap"
	        async defer>
	    </script>
		<style>
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			#map {
				top: 6%;
				height: 94%;
			}

		</style>
	</head>

	<body>
		<style type="text/css">
			header{
				background: black;
				height: 100%;
			}
		</style>	

		<header>
		    <div id="map"></div>

            <div style="position: absolute; left: 10px; top: 3px; font-size:30px; color: white;">Weather</div>
            <div style="position: absolute; left: 120px; top: 14px; font-size:20px; color: white;">best ever</div>


			<input style="font-size:20px; position: absolute; left: 400px; top: 0px; height: 36px;" id="city-input" type="text" placeholder="enter a location">


			<p style="background: white; font-size:20px; position: absolute; left: 900px; top: 50px;" id="city-name"></p>
			<p style="background: white; font-size:20px; position: absolute; left: 900px; top: 100px;" id="city-name2"></p>
			<p style="background: white; font-size:20px; position: absolute; left: 900px; top: 200px;" id="city-name3"></p>
			<p style="background: white; font-size:20px; position: absolute; left: 900px; top: 300px;" id="city-name4"></p>
			<p style="background: white; font-size:20px; position: absolute; left: 900px; top: 400px;" id="city-name5"></p>


            <div><a id="android_icon" href="#"><img style="position: absolute; left: 900px; top: 4px; height: 30px;" src="images/android_icon.png"></a></div>
            <div><a href="#"><img style="position: absolute; left: 1000px; top: 4px; height: 32px;" src="images/ios_icon.ico"></a></div>
            <div><a href="#"><img style="position: absolute; left: 1100px; top: 4px; height: 35px;" src="images/weixin_icon.png"></a></div>

            <img id="android_qr" style="position: absolute; left: 850px; top: 42px; height: 150px;" src="">
		    
		</header>

	    <script src="scripts/jquery-2.1.4.js"></script>

	    <script>
	    //google map
			// Note: This example requires that you consent to location sharing when
			// prompted by your browser. If you see the error "The Geolocation service
			// failed.", it means you probably did not give permission for the browser to
			// locate you.
			var cityInput = document.getElementById("city-input");
			var cityName1 = document.getElementById("city-name");
			var cityName2 = document.getElementById("city-name2");
			var cityName3 = document.getElementById("city-name3");
			var cityName5 = document.getElementById("city-name4");
			var cityName4 = document.getElementById("city-name5");
			var cityGo = document.getElementById("city-go");
			var city = -1;
			
			var pos = {
				lat: -1,
				lng: -1
	        };

			function initMap() {
			    var map = new google.maps.Map(document.getElementById('map'), {
			        center: {lat: 40.7127, lng: -74.0059},
			    	zoom: 4
			    });


			    //click, drop a marker with infoWindow--------------------
			    var infoWindow1 = new google.maps.InfoWindow({map: map});
				marker2 = new google.maps.Marker({
					map: map,
					draggable: true,
					animation: google.maps.Animation.DROP,
					label: "2"
				});
				google.maps.event.addListener(map, 'click', function (click) {
					marker2.setPosition(click.latLng);
					var apiUrl4 = "http://api.openweathermap.org/data/2.5/weather?lat=" + click.latLng.lat() + "&lon=" + click.latLng.lng();
					$.getJSON(apiUrl4, function(data4) {
						cityName4.innerHTML = "click: " + data4.coord.lon + ", " + data4.coord.lat + "<br>" + "api location: " + data4.name + "<br>" + ((data4.main.temp - 273.15).toFixed(2)) + "°C";
						infoWindow1.setContent(data4.name + "<br>" + ((data4.main.temp - 273.15).toFixed(2)) + "°C");
						infoWindow1.open(map, marker2);	
					});	
				});
				google.maps.event.addListener(marker2, 'drag', function() {
					var apiUrl4 = "http://api.openweathermap.org/data/2.5/weather?lat=" + marker2.getPosition().lat() + "&lon=" + marker2.getPosition().lng();
					$.getJSON(apiUrl4, function(data4) { 
						cityName4.innerHTML = "drag[2]: " + data4.coord.lon + ", " + data4.coord.lat + "<br>" + "api location: " + data4.name + "<br>" + ((data4.main.temp - 273.15).toFixed(2)) + "°C";
						infoWindow1.setContent(data4.name + "<br>" + ((data4.main.temp - 273.15).toFixed(2)) + "°C");
						infoWindow1.open(map, marker2);	
					});
				});				
			    //--------------------------------------------------
				
				//input, display weather--------------------
			    var infoWindow3 = new google.maps.InfoWindow({map: map});
				marker3 = new google.maps.Marker({
					map: map,
					draggable: true,
					animation: google.maps.Animation.DROP,
					label: "3"
				});				
				cityInput.addEventListener("input", cityDisplay);
				function cityDisplay() {
					city = cityInput.value;
				    cityName1.innerHTML = 'input: ' + city;
				}
				cityInput.onkeypress = function(e) {
				    var event = e || window.event;
				    var charCode = event.which || event.keyCode;

				    if ( charCode == '13' ) {
				      weatherDispaly();
				    }
				}
				function weatherDispaly() {
				    if (city != -1) {
					    var apiUrl2 = "http://api.openweathermap.org/data/2.5/weather?q=" + city ;
					    $.getJSON(apiUrl2, function(data2) {
					    	var inputLatlng = {
					    		lat: data2.coord.lat,
					    		lng: data2.coord.lon
					    	};
					    	marker3.setPosition(inputLatlng);
						    cityName2.innerHTML = "input: " + city + "<br>" + "api location: " + data2.name + "<br>" + ((data2.main.temp - 273.15).toFixed(2)) + "°C";
							infoWindow3.setContent(data2.name + "<br>" + ((data2.main.temp - 273.15).toFixed(2)) + "°C");
							infoWindow3.open(map, marker3);	
						    map.panTo(inputLatlng);
						    map.setZoom(6);
						});
					}
				}
				google.maps.event.addListener(marker3, 'drag', function() {
					var apiUrl2 = "http://api.openweathermap.org/data/2.5/weather?lat=" + marker3.getPosition().lat() + "&lon=" + marker3.getPosition().lng();
					$.getJSON(apiUrl2, function(data2) { 
						cityName2.innerHTML = "drag[3]: " + data2.coord.lon + ", " + data2.coord.lat + "<br>" + "api location: " + data2.name + "<br>" + ((data2.main.temp - 273.15).toFixed(2)) + "°C";
						infoWindow3.setContent(data2.name + "<br>" + ((data2.main.temp - 273.15).toFixed(2)) + "°C");
						infoWindow3.open(map, marker3);	
					});
				});					
				//--------------------------------------------------			


			    // Try HTML5 geolocation.
			    var infoWindow2 = new google.maps.InfoWindow({map: map});
			    if (navigator.geolocation) {
			        navigator.geolocation.getCurrentPosition(function(position) {
			            pos = {
					        lat: position.coords.latitude,
					        lng: position.coords.longitude
			        };
					map.setCenter(pos);
					map.setZoom(8);


					//drop a marker when located--------------------
					marker1 = new google.maps.Marker({
						map: map,
						draggable: true,
						animation: google.maps.Animation.DROP,
						position: pos,
						label: "1"
					});
					google.maps.event.addListener(marker1, 'drag', function() {
						var apiUrl5 = "http://api.openweathermap.org/data/2.5/weather?lat=" + marker1.getPosition().lat() + "&lon=" + marker1.getPosition().lng();
						$.getJSON(apiUrl5, function(data5) { 
							cityName5.innerHTML = "drag[1]: " + data5.coord.lon + ", " + data5.coord.lat + "<br>" + "api location: " + data5.name + "<br>" + ((data5.main.temp - 273.15).toFixed(2)) + "°C"; 
						infoWindow2.setContent(data5.name + "<br>" + ((data5.main.temp - 273.15).toFixed(2)) + "°C");
						infoWindow2.open(map, marker1);								 
						});
					});
					//--------------------------------------------------

					//display weather when located--------------------
					var apiUrl3 = "http://api.openweathermap.org/data/2.5/weather?lat=" + (pos.lat.toFixed(2)) + "&lon=" + (pos.lng.toFixed(2));
					$.getJSON(apiUrl3, function(data3) { 
						cityName3.innerHTML = "location: " + (pos.lat.toFixed(2)) + ", " + (pos.lng.toFixed(2)) + "<br>" + "api location: " + data3.name + "<br>" + ((data3.main.temp - 273.15).toFixed(2)) + "°C";
						infoWindow2.setContent(data3.name + "<br>" + ((data3.main.temp - 273.15).toFixed(2)) + "°C");
						infoWindow2.open(map, marker1);							
					});
					//--------------------------------------------------


			    }, function() {
					handleLocationError(true, infoWindow, map.getCenter());
			    });
				} else {
				    // Browser doesn't support Geolocation
				    handleLocationError(false, infoWindow, map.getCenter());
			    }
			}

			function handleLocationError(browserHasGeolocation, infoWindow, pos) {
				infoWindow.setPosition(pos);
				infoWindow.setContent(browserHasGeolocation ?
	                'Error: The Geolocation service failed.' :
	                'Error: Your browser doesn\'t support geolocation.');
			}
		</script>


	    <script type="text/javascript">
	    //display qr
	    	var androidIcon = document.getElementById("android_icon");
	    	var androidQr = document.getElementById("android_qr");

	    	androidIcon.addEventListener("mouseover", function() {
    			androidQr.src = "images/android_qr.jpg";
	    	});

	    	androidIcon.addEventListener("mouseleave", function() {
    			androidQr.src = "";
	    	});
	    </script>

	</body>
</html>
